{"remainingRequest":"/Users/cigar/Downloads/SnowSword-main/FrontEnd/snowsword/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/cigar/Downloads/SnowSword-main/FrontEnd/snowsword/src/views/filemanager/index.vue?vue&type=style&index=0&id=13197b4a&lang=css","dependencies":[{"path":"/Users/cigar/Downloads/SnowSword-main/FrontEnd/snowsword/src/views/filemanager/index.vue","mtime":1671438929000},{"path":"/Users/cigar/Downloads/SnowSword-main/FrontEnd/snowsword/node_modules/css-loader/dist/cjs.js","mtime":1715570462613},{"path":"/Users/cigar/Downloads/SnowSword-main/FrontEnd/snowsword/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1715570461645},{"path":"/Users/cigar/Downloads/SnowSword-main/FrontEnd/snowsword/node_modules/postcss-loader/src/index.js","mtime":1715570460320},{"path":"/Users/cigar/Downloads/SnowSword-main/FrontEnd/snowsword/node_modules/cache-loader/dist/cjs.js","mtime":1715570484549},{"path":"/Users/cigar/Downloads/SnowSword-main/FrontEnd/snowsword/node_modules/vue-loader/lib/index.js","mtime":1715570461633}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5jb250ZXh0bWVudSB7CiAgYm9yZGVyOiAxcHggc29saWQgI2NjYzsKICBiYWNrZ3JvdW5kOiAjZmZmOwogIHotaW5kZXg6IDMwMDA7CiAgcG9zaXRpb246IGFic29sdXRlOwogIGxpc3Qtc3R5bGUtdHlwZTogbm9uZTsKICBwYWRkaW5nOiA1cHggMDsKICBib3JkZXItcmFkaXVzOiA0cHg7CiAgZm9udC1zaXplOiAxNHB4OwogIGNvbG9yOiAjMzMzOwogIGJveC1zaGFkb3c6IDJweCAycHggM3B4IDAgcmdiYSgwLCAwLCAwLCAwLjIpOwp9Ci5jb250ZXh0bWVudSBsaSB7CiAgbWFyZ2luOiAwOwogIHBhZGRpbmc6IDVweCAxMHB4Owp9Ci5jb250ZXh0bWVudSBsaTpob3ZlciB7CiAgYmFja2dyb3VuZDogI2YyZjJmMjsKICBjdXJzb3I6IGRlZmF1bHQ7Cn0KLmVsLXRyZWUtbm9kZS5pcy1leHBhbmRlZCA+IC5lbC10cmVlLW5vZGVfX2NoaWxkcmVuewogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/filemanager","sourcesContent":["<template>\n  <el-container>\n    <el-main>\n      <el-tabs v-model=\"content.currentTabName\" type=\"card\" editable @edit=\"handleTabsEdit\">\n        <el-tab-pane\n          :key=\"item.name\"\n          v-for=\"item, index in content.tabs\"\n          :label=\"item.title\"\n          :name=\"item.name\"\n        >\n\n              <el-container>\n\n                <el-aside style=\"border:1px solid #e5e7ec;padding-top: 0px;max-height: 800px;\" width=\"30%\">\n                    <el-tree\n                    lazy\n                    :props=\"el_tree_props\"\n                    :load=\"(node, resolve) => loadNode(node, resolve, item)\"\n                    @node-click=\"(object,node,component) => nodeClick(node,item,index)\">\n                    </el-tree>\n                </el-aside>\n\n                <el-main style=\"padding-top: 0px;margin-left:10px;\">\n\n                  <el-descriptions title=\"属性\" :column=\"1\" border>\n                    <el-descriptions-item label=\"真实路径\">{{item.fileData.realpath}}</el-descriptions-item>\n                    <el-descriptions-item label=\"文件大小\">{{item.fileData.size}}</el-descriptions-item>\n                    <el-descriptions-item label=\"权限信息\">{{item.fileData.perms}}</el-descriptions-item>\n                    <el-descriptions-item label=\"inode修改时间\">{{item.fileData.inode_change_time}}</el-descriptions-item>\n                    <el-descriptions-item label=\"文件修改时间\">{{item.fileData.modification_time}}</el-descriptions-item>\n                  </el-descriptions>\n\n                  <br>\n\n                  <el-descriptions title=\"预览\" :colon=\"false\">\n                    <template slot=\"extra\">\n                      <el-form :inline=\"true\">\n                        <el-form-item label=\"文本限制(KB)\">\n                          <el-select \n                            size=\"mini\" \n                            v-model=\"item.txtLimit\" \n                            placeholder=\"大小\" \n                            style=\"width:100px\"\n                            filterable\n                            allow-create>\n                            <el-option value=\"100\"></el-option>\n                            <el-option value=\"512\"></el-option>\n                          </el-select>\n                        </el-form-item>\n\n                        <el-form-item label=\"图片限制(KB)\">\n                          <el-select \n                            size=\"mini\" \n                            v-model=\"item.imgLimit\" \n                            placeholder=\"大小\" \n                            style=\"width:100px\"\n                            filterable\n                            allow-create>\n                            <el-option value=\"1024\"></el-option>\n                            <el-option value=\"5120\"></el-option>\n                          </el-select>\n                        </el-form-item>\n                      </el-form>\n                    </template>\n\n                    <el-descriptions-item>\n                      <el-empty v-if=\"!(item.fileData.is_txt || item.fileData.is_dir || item.fileData.is_img)\" description=\"无法预览\"></el-empty>\n\n                      <el-input\n                        v-if=\"item.fileData.is_txt\" \n                        type=\"textarea\"\n                        :rows=\"20\"\n                        :readonly=\"true\"\n                        v-model=\"item.fileData.preview\">\n                      </el-input>\n\n                      <el-image\n                        v-if=\"item.fileData.is_img\" \n                        :src=\"item.fileData.preview\">\n                      </el-image>\n\n                      <el-table\n                        v-if=\"item.fileData.is_dir\" \n                        :data=\"item.fileData.preview\"\n                        style=\"width: 100%\">\n                        <el-table-column\n                          label=\"名称\">\n                          <template slot-scope=\"scope\">\n                            <i v-if=\"scope.row.is_dir\" class=\"el-icon-folder\"></i>\n                            <i v-if=\"!scope.row.is_dir\" class=\"el-icon-document\"></i>\n                            <span style=\"margin-left: 10px\">{{ scope.row.name }}</span>\n                          </template>\n                        </el-table-column>\n                        <el-table-column\n                          prop=\"size\"\n                          label=\"大小\">\n                        </el-table-column>\n                        <el-table-column\n                          prop=\"perms\"\n                          label=\"权限\">\n                        </el-table-column>\n                        <el-table-column\n                          prop=\"inode_change_time\"\n                          label=\"inode改变时间\">\n                        </el-table-column>\n                        <el-table-column\n                          prop=\"modification_time\"\n                          label=\"最后修改时间\">\n                        </el-table-column>\n                      </el-table>\n\n                    </el-descriptions-item>\n                  </el-descriptions>\n\n                </el-main>\n\n              </el-container>\n\n\n\n        </el-tab-pane>\n      </el-tabs>\n      <el-empty v-if=\"content.tabs.length == 0\" description=\"未选择Webshell\"></el-empty>\n    </el-main>\n\n    <el-dialog title=\"选择数据\" :visible.sync=\"selectWebshellForm.visible\" width=\"40%\">\n      <el-form :model=\"selectWebshellForm\">\n        <el-form-item label=\"URL\" required>\n          <el-select v-model=\"selectWebshellForm.webshellId\" placeholder=\"请选择\" style=\"width:85%\">\n            <el-option\n              v-for=\"item in webshells\"\n              :key=\"item.id\"\n              :label=\"item.url\"\n              :value=\"item.id\">\n            </el-option>\n          </el-select>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"selectWebshellForm.visible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"selectWebshell(true)\">确 定</el-button>\n      </div>\n    </el-dialog>\n\n  </el-container>\n</template>\n\n<style>\n  .contextmenu {\n    border: 1px solid #ccc;\n    background: #fff;\n    z-index: 3000;\n    position: absolute;\n    list-style-type: none;\n    padding: 5px 0;\n    border-radius: 4px;\n    font-size: 14px;\n    color: #333;\n    box-shadow: 2px 2px 3px 0 rgba(0, 0, 0, 0.2);\n  }\n  .contextmenu li {\n    margin: 0;\n    padding: 5px 10px;\n  }\n  .contextmenu li:hover {\n    background: #f2f2f2;\n    cursor: default;\n  }\n  .el-tree-node.is-expanded > .el-tree-node__children{\n    display: inline-block;\n  }\n</style>\n\n<script>\n  import request from '@/utils/request'\n\n  export default {\n    data() {\n      return {\n        el_tree_props:{\n          label: 'name',\n          isLeaf: 'is_leaf'\n        },\n\n        webshells: [\n        ],\n\n        content:{\n          currentTabName: \"1\",\n          tabIndex: 1,\n\n          tabs:[\n          ],\n        },\n\n        selectWebshellForm:{\n          visible: false,\n          webshellId: null,\n        }\n\n      }\n    },\n    methods: {\n      loadNode(node, resolve, item){\n        let path;\n        if (node.level === 0) {\n          path = \"\";\n        }else{\n          path = node.data.realpath;\n        }\n\n        request({\n          url: '/webshell/loadFilesById',\n          method: 'post',\n          data: { \n            id:item.webshellId,\n            path:path\n          } \n        }).then(response => {\n          resolve(response.data);\n          node.loaded = false;    //展开文件夹后，依然设置loaded为false，这样重新展开时才会再次请求后端，获取最新数据\n          node.isLeaf = false;    //展开空文件夹后，会变成叶子节点，这里手动设置成非叶子节点\n        }).catch(error => {\n          resolve([]);  //resolve空数组后，会变成叶子节点，下面设置回非叶子节点，并且设置为非展开未加载，让用户可以重新点击加载\n          node.expanded = false;\n          node.loaded = false;\n          node.isLeaf = false;\n          console.log(error);\n        })\n      },\n\n      nodeClick(node,item,index){\n        request({\n          url: '/webshell/previewFileById',\n          method: 'post',\n          data: { \n            id:item.webshellId,\n            path:node.data.realpath,\n            txtLimit:Number(item.txtLimit),\n            imgLimit:Number(item.imgLimit)\n          } \n        }).then(response => {\n          item.fileData = response.data;\n        }).catch(error => {\n          console.log(error);\n          console.log(error);\n        })\n      },\n\n      handleTabsEdit(targetName, action) {\n        if (action === 'add') {\n          this.selectWebshell(false);\n        }\n        if (action === 'remove') {\n          let tabs = this.content.tabs;\n          let activeName = this.content.currentTabName;\n          if (activeName === targetName) {\n            tabs.forEach((tab, index) => {\n              if (tab.name === targetName) {\n                let nextTab = tabs[index + 1] || tabs[index - 1];\n                if (nextTab) {\n                  activeName = nextTab.name;\n                }\n              }\n            });\n          }\n          \n          this.content.currentTabName = activeName;\n          this.content.tabs = tabs.filter(tab => tab.name !== targetName);\n        }\n      },\n\n      fetchWebshellData(){\n        request({\n          url: '/webshell/findAll',\n          method: 'get',\n        }).then(response => {\n          this.webshells = response.data;\n        }).catch(error => {\n          console.log(error);\n        })\n      },\n\n      selectWebshell(isAddTab){\n        if(isAddTab){\n          this.selectWebshellForm.visible = false;\n          let newTabName = ++this.content.tabIndex + '';\n          let webshellId = this.selectWebshellForm.webshellId;\n\n          let index = this.content.tabs.push({\n            title: \"加载中...\",\n            name: newTabName,\n            webshellId:webshellId,\n            fileData:\"\",\n            txtLimit:100,\n            imgLimit:1024\n          })-1;\n          this.content.currentTabName = newTabName;\n\n          request({\n            url: '/webshell/getAndUpdateInfoById',\n            method: 'get',\n            params: { id:webshellId } \n          }).then(response => {\n            var url = response.data.url;\n            var res = url.match(/https?:\\/\\/(.*)?\\//);\n            if(res){\n              this.content.tabs[index].title = res[1];\n            }else{\n              this.content.tabs[index].title = url;\n            }\n            this.$forceUpdate();\n          }).catch(error => {\n            this.content.tabs[index].title = \"加载失败\";\n            console.log(error);\n          })\n\n\n\n        }else{\n          this.selectWebshellForm.visible = true;\n        }\n      },\n\n\n    },\n\n    created(){\n      this.fetchWebshellData();\n      this.name = this.$route.name;\n      if(this.$route.params.id){\n        this.selectWebshellForm.webshellId = this.$route.params.id\n        this.selectWebshell(true);\n      }\n    },\n\n    watch: {\n      $route(to, from) {\n        if(to.name == this.name){\n          this.fetchWebshellData();\n          if(this.$route.params.id){\n            this.selectWebshellForm.webshellId = this.$route.params.id\n            this.selectWebshell(true);\n          }\n        }\n      }\n    },\n\n    mounted(){\n      window.vue = this;\n    },\n\n  };\n</script>"]}]}